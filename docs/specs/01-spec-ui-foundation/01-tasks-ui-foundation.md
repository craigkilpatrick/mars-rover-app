# 01-tasks-ui-foundation

## Relevant Files

### Modified Files

- `package.json` — Remove MUI/Emotion deps, add Tailwind, shadcn/ui prereqs, JetBrains Mono
- `tsconfig.json` — Add `@` path alias (`"paths": { "@/*": ["./src/*"] }`) required by shadcn/ui
- `vite.config.ts` — Add `resolve.alias` for `@`, remove MUI vendor chunk from `manualChunks`
- `src/main.tsx` — Remove Roboto + MUI CssBaseline/ThemeProvider; add JetBrains Mono import
- `src/index.css` — Replace MUI resets with Tailwind v4 directives and `@theme` design tokens
- `src/App.css` — Delete unused boilerplate (logo spin animation)
- `src/App.tsx` — Remove MUI JSX/imports; restructure to full-viewport HUD layout; add toast calls
- `src/components/RoverGrid.tsx` — Add `ResizeObserver` for dynamic canvas sizing; remove fixed 500×500
- `src/components/RoverList.tsx` — Full rewrite: shadcn/ui rover cards fleet panel
- `src/components/RoverControls.tsx` — Full rewrite: shadcn/ui directional pad + command input
- `src/test/setup.ts` — Add `ResizeObserver` global mock for jsdom
- `src/App.test.tsx` — Remove `ThemeProvider`; replace MUI selectors with accessible queries
- `src/components/__tests__/RoverGrid.test.tsx` — Remove hard-coded 500px assertions; test dynamic sizing
- `src/components/__tests__/RoverList.test.tsx` — Full rewrite: remove ThemeProvider + MUI selectors

### New Files

- `postcss.config.js` — PostCSS config with `@tailwindcss/postcss` plugin
- `components.json` — shadcn/ui configuration (auto-generated by `npx shadcn@latest init`)
- `src/lib/utils.ts` — shadcn/ui `cn()` helper (auto-generated by `npx shadcn@latest init`)
- `src/components/ui/` — shadcn/ui component files (auto-generated per `npx shadcn@latest add`)
- `src/components/TopBar.tsx` — Fixed 48px top bar with title and connection status
- `src/components/RoverCard.tsx` — Compact rover card: color swatch, ID, coords, direction
- `src/components/DirectionalPad.tsx` — Cross-layout F/B/L/R button grid
- `src/components/__tests__/TopBar.test.tsx` — Unit tests for TopBar
- `src/components/__tests__/RoverControls.test.tsx` — Unit tests for RoverControls (new file)

### Notes

- Run tests with `make test:run` (Vitest) and `make test:e2e` (Playwright).
- Tailwind CSS v4 uses CSS-based configuration (`@theme { }` in `index.css`) instead of
  `tailwind.config.ts`. The PostCSS plugin is `@tailwindcss/postcss`, not `tailwindcss`.
- shadcn/ui `init` is interactive. Run it manually in the terminal: `npx shadcn@latest init`.
  Select: Style → New York, Base color → Zinc, CSS variables → Yes.
- The `@` alias must be added to both `tsconfig.json` (for TypeScript) and `vite.config.ts`
  (for the dev server/build). shadcn's `init` may handle this automatically — verify after running.
- `src/test/setup.ts` currently mocks the Canvas API. The `ResizeObserver` mock must be added
  here without removing the existing canvas mock.
- Follow conventional commits: lowercase subject, type prefix
  (e.g., `feat(top-bar): add mission control header with connection status`).
- All sub-tasks within a parent task should be committed together as one conventional commit
  (or in small logical groups), not as individual micro-commits.

---

## Tasks

### [x] 1.0 Remove MUI and establish the deep-space theme foundation

#### 1.0 Proof Artifact(s)

- CLI: `npm ls @mui/material` returns an empty result, demonstrating MUI has been fully removed.
- CLI: `make type-check && make lint && make test:run` all exit 0, demonstrating the project is
  clean after the dependency swap.
- Screenshot: `http://localhost:3000` renders with a near-black (`#0a0a0f`) background and
  JetBrains Mono font visible in browser DevTools, demonstrating theme tokens are applied.

#### 1.0 Tasks

- [x] 1.1 Uninstall all MUI and Emotion packages:
      `npm uninstall @mui/material @mui/icons-material @emotion/react @emotion/styled @fontsource/roboto`

- [x] 1.2 Install Tailwind CSS v4 and its PostCSS plugin:
      `npm install -D tailwindcss @tailwindcss/postcss postcss`

- [x] 1.3 Install JetBrains Mono font package:
      `npm install @fontsource/jetbrains-mono`

- [x] 1.4 Run shadcn/ui initialization in the terminal (interactive):
      `npx shadcn@latest init`
      When prompted: Style → **New York**, Base color → **Zinc**, CSS variables → **Yes**.
      This generates `components.json`, `src/lib/utils.ts`, updates `index.css`, and adds
      the `@` path alias to `tsconfig.json` and `vite.config.ts`. Verify both files were updated.

- [x] 1.5 Create `postcss.config.js` in the project root with the `@tailwindcss/postcss` plugin:

  ```js
  export default {
    plugins: {
      '@tailwindcss/postcss': {},
    },
  }
  ```

- [x] 1.6 Replace the contents of `src/index.css` with Tailwind v4 directives and the
      mission-control design tokens using the `@theme` block:

  - `@import "tailwindcss";`
  - `@theme` block defining all color tokens from the spec
    (`--color-background: #0a0a0f`, `--color-surface: #0f1117`,
    `--color-accent-cyan: #06b6d4`, `--color-accent-blue: #3b82f6`,
    `--color-text: #e2e8f0`, `--color-text-muted: #64748b`,
    `--color-destructive: #ef4444`)
  - Global `html, body` styles: `background-color: #0a0a0f`, `color: #e2e8f0`,
    `font-family: 'JetBrains Mono', monospace`, `margin: 0`, `padding: 0`

- [x] 1.7 Update `src/main.tsx`:

  - Remove `import '@fontsource/roboto/...'` lines
  - Remove `CssBaseline` and `ThemeProvider` imports and JSX wrappers
  - Add `import '@fontsource/jetbrains-mono'`
  - The file should now only import React, `App`, `index.css`, JetBrains Mono, and call
    `ReactDOM.createRoot(...).render(<StrictMode><App /></StrictMode>)`

- [x] 1.8 Update `vite.config.ts`:

  - Remove the `@mui/material` and `@fontsource` entries from the `manualChunks` object
    in the `build.rollupOptions` section
  - Confirm the `@` alias is present under `resolve.alias` (added by shadcn `init` in step 1.4;
    add manually if missing: `'@': path.resolve(__dirname, './src')`)

- [x] 1.9 Update `src/App.tsx` — remove all MUI imports and replace MUI JSX with plain HTML:

  - Remove: `Container`, `Box`, `CircularProgress`, `Alert`, `Snackbar`, `Button` imports
  - Replace loading state `<Box>...<CircularProgress /></Box>` with a plain
    `<div data-testid="loading">Loading...</div>`
  - Replace `<Container maxWidth="lg">` wrapper with `<div>`
  - Replace all `<Box sx={...}>` wrappers with `<div>`
  - Replace `<Alert>` error banner with `<div data-testid="error-banner">{error}</div>`
    and a plain `<button onClick={() => setError(null)}>Dismiss</button>`
  - Replace `<Snackbar>/<Alert>` notification with
    `<div data-testid="notification">{notification}</div>` (shown only when notification !== null)
  - Replace the MUI `<Button>` for "Add Random Obstacle" with a plain `<button>`
  - Keep ALL state management, API calls, and callback logic unchanged

- [x] 1.10 Update `src/components/RoverList.tsx` — remove MUI, replace with semantic HTML:

  - Remove all `@mui/material` and `@mui/icons-material` imports
  - Replace the MUI `List`/`ListItem`/`ListItemButton` structure with `<ul>`/`<li>`/`<button>`
  - Each rover item: `<li key={rover.id}><button onClick={() => onSelectRover(rover.id)}
data-testid={`rover-item-${rover.id}`} data-selected={rover.id === selectedRoverId}>
Rover {rover.id} ({rover.x}, {rover.y}) {rover.direction}</button></li>`
  - Replace delete `IconButton` with `<button data-testid="delete-rover"
onClick={() => onDeleteRover(selectedRoverId!)} disabled={!selectedRoverId}>Delete</button>`
  - Replace add `IconButton` with `<button onClick={onAddRover}>Add New Rover</button>`

- [x] 1.11 Update `src/components/RoverControls.tsx` — remove MUI, replace with semantic HTML:

  - Remove all `@mui/material` and `@mui/icons-material` imports
  - Replace `Paper` wrapper with `<div>`
  - Replace MUI `TextField` with `<input type="text" />` preserving all existing value/onChange
    logic (max length 20, strip invalid chars)
  - Replace MUI `Button` components with `<button>` elements
  - Preserve all command logic and props interface unchanged

- [x] 1.12 Update `src/App.test.tsx` — remove MUI test dependencies:

  - Remove `ThemeProvider`, `createTheme` imports
  - Remove the `renderWithTheme` helper; replace all `renderWithTheme(<App />)` calls
    with `render(<App />)`
  - Replace `getByRole('progressbar')` with `getByTestId('loading')`
  - Replace `.toHaveClass('Mui-selected')` assertion with a check that the button has
    `data-selected="true"` attribute
  - Replace `getByTestId('DeleteIcon').closest('button')` with
    `getByTestId('delete-rover')`
  - Replace `getByTestId('AddIcon').closest('button')` with
    `getByRole('button', { name: /add new rover/i })`

- [x] 1.13 Update `src/components/__tests__/RoverList.test.tsx` — remove MUI test dependencies:

  - Remove `ThemeProvider`, `createTheme` imports
  - Remove the `renderWithTheme` helper; replace all calls with plain `render(...)`
  - Replace `.toHaveClass('Mui-selected')` with `.toHaveAttribute('data-selected', 'true')`

- [x] 1.14 Delete `src/App.css` (the Vite boilerplate with the spinning logo animation).
      Remove its import from `main.tsx` if present.

- [x] 1.15 Run `make type-check && make lint && make test:run`. Fix any TypeScript errors,
      lint violations, or test failures before proceeding to Task 2.0.

---

### [x] 2.0 Restructure app layout to full-screen canvas with floating HUD shell

#### 2.0 Proof Artifact(s)

- Screenshot: `http://localhost:3000` shows the canvas edge-to-edge with the "MISSION CONTROL"
  top bar and empty left/right HUD panel slots overlaid, demonstrating the full-viewport layout.
- Screenshot: Browser DevTools Network tab shows successful API calls to `/api/rovers` and
  `/api/obstacles` on page load, demonstrating the data layer is unaffected by the layout change.
- Test: `RoverGrid` unit test suite passes with updated assertions, demonstrating the canvas
  component contract is preserved with dynamic sizing.

#### 2.0 Tasks

- [x] 2.1 Add a `ResizeObserver` global mock to `src/test/setup.ts` so jsdom tests don't throw:

  ```ts
  global.ResizeObserver = class ResizeObserver {
    observe() {}
    unobserve() {}
    disconnect() {}
  }
  ```

- [x] 2.2 Update `src/components/RoverGrid.tsx` — add dynamic canvas sizing:

  - Add a `containerRef = useRef<HTMLDivElement>(null)` on the outer wrapper `<div>`
  - Add a `useEffect` that creates a `ResizeObserver` on `containerRef.current`. In its callback,
    set `canvas.width = entry.contentRect.width` and `canvas.height = entry.contentRect.height`,
    then re-run the draw logic. Call `observer.disconnect()` on cleanup.
  - Change the wrapper `<div>` to use `className="w-full h-full"` instead of a fixed inline style.
  - Remove the hard-coded `width={500} height={500}` attributes from the `<canvas>` element.
    The canvas dimensions are now set by the `ResizeObserver` only.

- [x] 2.3 Update `src/components/__tests__/RoverGrid.test.tsx`:

  - Remove all `toHaveAttribute('width', '500')` and `toHaveAttribute('height', '500')` assertions
    (the `ResizeObserver` mock returns 0-size in jsdom, so the canvas has no fixed dimensions)
  - Replace the `border: '1px solid #ccc'` style assertion with a check that the canvas element
    is present in the document: `expect(canvas).toBeInTheDocument()`
  - All other test cases (empty rovers, selected rover, boundary coords) need only verify that
    the `<canvas>` element exists — no dimension assertions

- [x] 2.4 Create `src/components/TopBar.tsx`:

  - A `fixed` bar: `className="fixed top-0 left-0 right-0 h-12 z-50 flex items-center
justify-between px-4 border-b border-white/[0.08] backdrop-blur-md bg-surface/80"`
  - Left side: `<span>` with text "MISSION CONTROL" styled with
    `className="text-accent-cyan font-mono tracking-[0.3em] text-sm font-bold uppercase"`
  - Right side: `ConnectionStatus` sub-component (can be in the same file) that accepts
    `isConnected: boolean`. Renders a colored dot + label:
    - Connected: `<span className="text-green-400">● CONNECTED</span>`
    - Disconnected: `<span className="text-destructive">● DISCONNECTED</span>`
  - Props interface: `TopBarProps { isConnected: boolean }`

- [x] 2.5 Create `src/hooks/useApiHealth.ts`:

  - A custom hook that runs a `GET /api/rovers` fetch on mount (inside a `useEffect`)
  - Returns `{ isConnected: boolean }` — `true` if the fetch resolves, `false` if it rejects
  - Uses `useState(false)` for initial disconnected state until the check completes

- [x] 2.6 Restructure `src/App.tsx` layout:

  - Change the root `<div>` to `className="relative h-screen w-screen overflow-hidden bg-background"`
  - Add `<RoverGrid>` as the first child so it fills the full viewport behind everything else
  - Add `<TopBar isConnected={isConnected} />` as a fixed overlay (it positions itself via CSS)
  - Add a left HUD panel slot: `<div className="fixed left-0 top-12 w-60 h-[calc(100vh-3rem)]
border-r border-white/[0.08] backdrop-blur-md bg-surface/80" />` — empty for now
  - Add a right HUD panel slot: `<div className="fixed right-0 top-12 w-72 h-[calc(100vh-3rem)]
border-l border-white/[0.08] backdrop-blur-md bg-surface/80" />` — empty for now
  - Wire `useApiHealth` hook: `const { isConnected } = useApiHealth()`
  - Remove the old MUI layout divs (Container, flex Box wrappers)
  - Keep all state, callbacks, and the notification/error logic (still as plain `<div>` stubs
    from Task 1.0 — toast wiring comes in Task 4.0)

- [x] 2.7 Create `src/components/__tests__/TopBar.test.tsx`:

  - Test 1: renders "MISSION CONTROL" text when given any props
  - Test 2: renders "CONNECTED" with green indicator when `isConnected={true}`
  - Test 3: renders "DISCONNECTED" with red indicator when `isConnected={false}`

- [x] 2.8 Run `make type-check && make lint && make test:run`. Fix any errors before
      proceeding to Task 3.0.

---

### [x] 3.0 Build the Rover Fleet left panel with compact rover cards

#### 3.0 Proof Artifact(s)

- Screenshot: Rover Fleet panel with two or more rover cards, each showing a color circle,
  rover ID, `X: ## Y: ##` coordinates in muted text, and a cyan direction letter, demonstrating
  the compact card layout.
- Screenshot: One rover card highlighted with a cyan left border (`border-l-2 border-cyan-400`),
  demonstrating the active selection state.
- Test: `RoverList` unit test suite passes and covers card data rendering, active selection
  styling, click-to-select, add, and delete.

#### 3.0 Tasks

- [x] 3.1 Install shadcn/ui Card, Badge, and Separator components:
      `npx shadcn@latest add card badge separator`
      Verify the generated files appear in `src/components/ui/`.

- [x] 3.2 Create `src/components/RoverCard.tsx`:

  - Props: `rover: Rover`, `isSelected: boolean`,
    `onSelect: (id: number) => void`, `onDelete: (id: number) => void`
  - Outer wrapper: a `<button>` with `onClick={() => onSelect(rover.id)}`,
    `data-testid={`rover-card-${rover.id}`}`, and conditional class
    `isSelected ? 'border-l-2 border-cyan-400 bg-white/[0.05]' : 'border-l-2 border-transparent'`
  - Inside: a color circle `<span>` with `style={{ backgroundColor: rover.color }}`
    sized 12×12px (`w-3 h-3 rounded-full`)
  - Rover ID: `<span className="font-mono text-sm text-text">ROV-{rover.id}</span>`
  - Coordinates: `<span className="font-mono text-xs text-text-muted">X: {rover.x} Y: {rover.y}</span>`
  - Direction: `<span className="font-mono text-sm text-accent-cyan font-bold">{rover.direction}</span>`
  - Delete button (only visible when `isSelected`):
    `<button onClick={e => { e.stopPropagation(); onDelete(rover.id) }}
aria-label="delete rover" data-testid="delete-rover">✕</button>`

- [x] 3.3 Rewrite `src/components/RoverList.tsx` using the new `RoverCard` component:

  - Remove all HTML stub code from Task 1.0
  - Outer panel: `<div className="flex flex-col h-full p-3 gap-2">`
  - Panel header: `<div>` containing "FLEET" label (`text-xs tracking-widest text-text-muted
uppercase`) + shadcn/ui `<Badge>` showing `{rovers.length}` with muted styling
  - Rover list: `<div className="flex-1 overflow-y-auto flex flex-col gap-1">` mapping
    `rovers` to `<RoverCard>` components
  - Footer: shadcn/ui `<Button variant="ghost" size="sm">` with a `+` icon and "Add Rover" label,
    `onClick={onAddRover}`, full-width, `data-testid="add-rover"`
  - Preserve props interface: `rovers`, `selectedRoverId`, `onSelectRover`, `onAddRover`,
    `onDeleteRover`

- [x] 3.4 Rewrite `src/components/__tests__/RoverList.test.tsx` — final test suite:

  - Remove `ThemeProvider` and transitional HTML stubs from Tasks 1.0–1.13
  - Test 1: renders a card for each rover with correct ID, coordinates, and direction
  - Test 2: selected card has `border-l-2 border-cyan-400` class (use `toHaveClass`)
  - Test 3: clicking a card calls `onSelectRover` with the correct rover ID
  - Test 4: delete button on selected card calls `onDeleteRover` with the correct rover ID
  - Test 5: "Add Rover" button calls `onAddRover`
  - Test 6: fleet header badge shows the correct rover count
  - Test 7: renders without error when `rovers` array is empty

- [x] 3.5 Wire the left HUD panel slot in `src/App.tsx`:

  - Replace the empty left `<div>` placeholder from Task 2.6 with `<RoverList>`,
    passing `rovers`, `selectedRoverId`, `onSelectRover={setSelectedRoverId}`,
    `onAddRover={handleAddRover}`, `onDeleteRover={handleDeleteRover}`

- [x] 3.6 Run `make type-check && make lint && make test:run`. Fix any errors before
      proceeding to Task 4.0.

---

### [ ] 4.0 Build the Mission HQ right panel with directional pad and toast notifications

#### 4.0 Proof Artifact(s)

- Screenshot: Mission HQ panel showing the directional pad in cross formation, the command
  string text input below it, and the "Execute" button, demonstrating the full command interface.
- Screenshot: A shadcn/ui (Sonner) Toast notification visible at the bottom of the screen after
  a command executes, demonstrating the notification system works.
- Test: `RoverControls` unit test suite passes, covering directional buttons, text input
  filtering, execute submission, and no-rover placeholder state.
- CLI: `make test:run && make test:e2e` both exit 0, demonstrating no regressions across
  the full test suite.

#### 4.0 Tasks

- [ ] 4.1 Install shadcn/ui Button, Input, and Sonner (toast) components:
      `npx shadcn@latest add button input sonner`

- [ ] 4.2 Create `src/components/DirectionalPad.tsx`:

  - Props: `onCommand: (cmd: Command) => void`, `disabled: boolean`
  - Render a 3-column CSS grid (`grid grid-cols-3 gap-1 w-fit mx-auto`)
  - Place buttons in cardinal positions. Empty cells use `<div />`:
    ```
    [empty]  [↑ FWD]  [empty]
    [← L  ]  [empty]  [→ R  ]
    [empty]  [↓ BWD]  [empty]
    ```
  - Each button: shadcn/ui `<Button variant="outline">` with `className="w-12 h-12 p-0
hover:border-accent-cyan hover:text-accent-cyan"`, `disabled={disabled}`,
    and `onClick` calling `onCommand` with `'f'`, `'b'`, `'l'`, or `'r'`
  - Add `aria-label` to each button: `"forward"`, `"backward"`, `"turn left"`, `"turn right"`

- [ ] 4.3 Rewrite `src/components/RoverControls.tsx` using shadcn/ui components:

  - Remove all HTML stub code from Task 1.0
  - Props interface unchanged: `rover: Rover | undefined`, `onSendCommands: (cmds: Command[]) => void`
  - When `rover` is `undefined`: render a placeholder `<div data-testid="no-rover-placeholder">
Select a rover to begin</div>` with all controls absent
  - When `rover` is defined:
    - Panel header: rover ID + status string `X: {rover.x} Y: {rover.y} | DIR: {rover.direction}`
    - `<DirectionalPad>` wired to call `onSendCommands([cmd])`
    - A shadcn/ui `<Input>` with `value`, `onChange` that strips non-`f/b/l/r` characters
      (use `.replace(/[^fblr]/gi, '').toLowerCase()`) and enforces `maxLength={20}`
    - A shadcn/ui `<Button>` labeled "Execute" that calls
      `onSendCommands(commandString.split('') as Command[])` then clears the input
  - Add `data-testid="command-input"` to the Input and `data-testid="execute-btn"` to the Button

- [ ] 4.4 Add Sonner `<Toaster>` to `src/App.tsx` and replace the plain `<div>` notification/error
      stubs from Task 1.0 with `toast()` calls:

  - Import `{ Toaster, toast }` from `sonner`
  - Add `<Toaster position="bottom-center" theme="dark" />` inside the root `<div>`
  - In `handleSendCommands`: on success call `toast.success('Commands executed')`;
    on obstacle detection call `toast.warning(result.message || 'Obstacle detected')`;
    on catch call `toast.error('Failed to send commands: ' + errorMessage)`
  - In `handleAddRover` on catch: call `toast.error('Failed to create rover: ...')`
  - In `handleDeleteRover` on catch: call `toast.error('Failed to delete rover: ...')`
  - In `addRandomObstacle` on success: call `toast.success('Obstacle added at (${x}, ${y})')`
  - Remove the `notification` state variable and `error` state variable; remove all remaining
    `<div data-testid="notification">` and `<div data-testid="error-banner">` stubs

- [ ] 4.5 Wire the right HUD panel slot in `src/App.tsx`:

  - Replace the empty right `<div>` placeholder from Task 2.6 with `<RoverControls>`,
    passing `rover={selectedRover}` and `onSendCommands={handleSendCommands}`
  - Move the "Add Random Obstacle" button inside the RoverControls panel or as a footer
    element of the right HUD panel div

- [ ] 4.6 Create `src/components/__tests__/RoverControls.test.tsx` — new test file:

  - Test 1: renders "Select a rover" placeholder when `rover` prop is `undefined`
  - Test 2: renders rover ID and status string when `rover` is provided
  - Test 3: FWD button (`aria-label="forward"`) calls `onSendCommands(['f'])`
  - Test 4: BWD button (`aria-label="backward"`) calls `onSendCommands(['b'])`
  - Test 5: L button (`aria-label="turn left"`) calls `onSendCommands(['l'])`
  - Test 6: R button (`aria-label="turn right"`) calls `onSendCommands(['r'])`
  - Test 7: typing `'ffXZ12lr'` into the command input results in value `'fflr'`
    (invalid chars stripped)
  - Test 8: clicking Execute calls `onSendCommands` with the command string split into
    an array, then clears the input

- [ ] 4.7 Update `src/App.test.tsx` — replace remaining stubs with final assertions:

  - Replace `getByTestId('loading')` with an appropriate check that matches the final
    loading indicator in App (a spinner, text, or whatever is implemented)
  - Replace `getByTestId('error-banner')` checks with `toast` mock verification if needed,
    or check that `toast.error` was called (mock Sonner in test setup)
  - Remove the `getByTestId('notification')` reference if present

- [ ] 4.8 Update Playwright e2e tests in `tests/`:

  - Remove any MUI class selectors (`.MuiListItem-root`, `.MuiAlert-root`, `.Mui-selected`)
  - Replace with `data-testid` selectors (`[data-testid="rover-card-1"]`) or accessible
    role selectors (`getByRole('button', { name: /forward/i })`)

- [ ] 4.9 Run `make test:run && make test:e2e` and fix any remaining failures.

- [ ] 4.10 Run `make build` and note the final bundle size. Verify MUI packages are absent
      from the build output (`dist/assets/` should contain no chunk named `mui`).
